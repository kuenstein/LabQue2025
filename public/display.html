<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laboratory Queue System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: rgb(0, 0, 0);
            text-align: center;
            color: #1a73e8;
        }
        .container {
            max-width: 2000px;
            margin: 0 auto;
        }
        h1 {
            font-size: 36px;
            font-weight: bold;
            color: #1a73e8;
        }
        .announcements {
            font-size: 60px;
            margin: 20px 0;
            color: rgb(255, 250, 250);
            background-color: #000000;
            padding: 10px;
            border-radius: 5px;
            overflow: hidden;
            white-space: nowrap;
        }
        .announcement-text {
            display: inline-block;
            animation: scroll 20s linear infinite;
        }
        @keyframes scroll {
            0% {
                transform: translateX(100%);
            }
            100% {
                transform: translateX(-100%);
            }
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        .counter {
            padding: 20px;
            border: 2px solid #1a73e8;
            border-radius: 5px;
            background-color: #e8f0fe;
        }
        .counter h2 {
            font-size: 30px;
            font-weight: bold;
            color: #1a73e8;
        }
        .number {
            font-size: 250px;
            font-weight: bold;
            color: #f80303;
            animation: flash 1s infinite alternate;
        }
        @keyframes flash {
            0% {
                opacity: 1;
            }
            100% {
                opacity: 0.3;
            }
        }
        footer {
            margin-top: 20px;
            padding: 10px;
            background-color: #000000;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>LABORATORY QUEUE SYSTEM</h1>
        <div class="announcements">
            <div class="announcement-text" id="announcement-display">No announcements at this time.</div>
        </div>
        <div class="grid" id="counters-status"></div>
    </div>
    <footer>
        <p>Â© 2025 HIMS Department. All rights reserved.</p>
    </footer>

    <script>
        async function updateDisplay() {
            try {
                const response = await fetch('http://10.0.5.24:3000/queue');
                const data = await response.json();
                let countersStatus = '';

                for (const service in data) {
                    const currentNumber = data[service].current ? data[service].current.number : '-';
                    countersStatus += `
                        <div class="counter">
                            <h2>${service.toUpperCase()} COUNTER</h2>
                            <div class="number">${currentNumber}</div>
                        </div>
                    `;
                }

                document.getElementById("counters-status").innerHTML = countersStatus;
            } catch (error) {
                console.error("Error updating display:", error);
            }
        }

        async function updateAnnouncement() {
            try {
                const response = await fetch('http://10.0.5.24:3000/announcement');
                const data = await response.json();
                document.getElementById("announcement-display").textContent = data.announcement || "No announcements at this time.";
            } catch (error) {
                console.error("Error fetching announcement:", error);
            }
        }

        function speak(text) {
            if (!window.speechSynthesis) return;

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.volume = 1;
            utterance.rate = 1;
            utterance.pitch = 1;
            window.speechSynthesis.cancel();
            window.speechSynthesis.speak(utterance);
        }

        const socket = new WebSocket("ws://10.0.5.24:8080");
        socket.onmessage = function(event) {
            const msg = event.data;
            console.log("WebSocket Received:", msg);
            if (msg.startsWith("Now serving number")) {
                speak(msg);
            } else if (msg.startsWith("Recall number")) {
                speak(msg);
            }
        };

        updateDisplay();
        updateAnnouncement();
        setInterval(updateDisplay, 2000);
        setInterval(updateAnnouncement, 5000);

        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });
    </script>
</body>
</html>
